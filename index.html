<!DOCTYPE html>
<html>
<head>
  <title>CO Visualization Clone</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css">
  <style>
    #map { height: 100vh; }
  </style>
</head>
<body>
  <div id="map"></div>

  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script>
    // 1. Configure credentials
    const CLIENT_ID = "sh-3e397c85-30e1-4067-9bec-975aa62d574a";
    const CLIENT_SECRET = "oEGik5bM249xxsAowSiSvwmK43qdqsBQ";

    // 2. Get access token
    async function getToken() {
      const response = await fetch('https://identity.dataspace.copernicus.eu/auth/realms/CDSE/protocol/openid-connect/token', {
        method: 'POST',
        headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
        body: new URLSearchParams({
          client_id: CLIENT_ID,
          client_secret: CLIENT_SECRET,
          grant_type: 'client_credentials'
        })
      });
      return (await response.json()).access_token;
    }

    // 3. Initialize map
    const map = L.map('map').setView([38.40674, 117.69653], 7);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);

    // 4. Load CO layer
    async function loadCOLayer() {
      const token = await getToken();
      const date = '2023-12-24'; // Test date with known data
      
      L.tileLayer.wms('https://sh.dataspace.copernicus.eu/wms', {
        layers: 'S5P_L2__CO_____',
        styles: 'RASTER/CO_VISUALIZED',
        format: 'image/png',
        transparent: true,
        time: `${date}T00:00:00Z/${date}T23:59:59Z`,
        crs: L.CRS.EPSG3857,
        access_token: token,
        colorscalerange: '0,0.12',
        opacity: 0.85
      }).addTo(map);
    }

    loadCOLayer();
  </script>
</body>
</html>
